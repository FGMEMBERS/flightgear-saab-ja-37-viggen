<?xml version="1.0"?>

<flight_control name="JA37 FC">

    <channel name="Canopy">
      
        <!-- canopy get stuck if it fail -->
        <switch name="names/canopy/tmp-engage">
          <default value="fcs/canopy/engage"/>
          <test logic="OR" value="fcs/canopy-pos-norm">
            fcs/canopy/serviceable == 0
            fcs/canopy/has-power == 0
          </test>
          <output>fcs/canopy-engageTmp</output>
        </switch>

        <kinematic name="names/canopy/pos-norm">
            <input>fcs/canopy-engageTmp</input>
            <traverse>
                <setting>
                    <position>0.0</position>
                    <time>0.0</time>
                </setting>
                <setting>
                    <position>1.0</position>
                    <time>5.0</time>
                </setting>
            </traverse>
            <output>fcs/canopy-pos-norm</output>
        </kinematic>

        <pure_gain name="names/canopy/mp">
          <input>fcs/canopy-pos-norm</input>
          <gain>1</gain>
          <output>/canopy/position-norm</output><!-- used for auto MP transmit and animation -->
      </pure_gain>
    </channel>

<!--
                   Elevator -25 to +20  (page 131, figure 108b) 
                   Elevator -25 to +20  (page 133, figure 110a)
                   Elevator -25 to +20  (page  79, figure  62a)
                   Pretty sure I saw something about max +10 for elevator, but no longer know where.

                   Aileron  -15 to +15  (page 133, figure 110b)

                   Rudder   -25 to +25  (page 115, figure  92 )

                   Flaps           +30  (page  87)
                   Flaps     -4 to +30  (page  78,  figure 60 )
                   Flaps     -7 to +30  (page  76) -7 can be selected by pilot in AJ-37 not JA-37, -4 default
                   Flaps     -7 to +30  (page  46) 

-->


    <channel name="Elevons">
      <!-- Elevator contribution can move elevons 20 degrees down, and 25 degrees up -->

      <switch name="names/pitch-damper/active">
        <default value="0.0"/>
        <test logic="AND" value="1">
            aero/alpha-deg ge -10
            aero/alpha-deg le  15
            fcs/elevator-cmd-norm ge -0.15
            fcs/elevator-cmd-norm le 0.15
            fcs/pitch-damper/enable ne 0.0
            fcs/pitch-damper/serviceable == 1
        </test>
        <output>fcs/pitch-damper/active</output>
      </switch>

      <scheduled_gain name="names/pitch-damper/rate">
        <input>velocities/q-aero-rad_sec</input>
        <table>
          <independentVar lookup="row">velocities/ve-kts</independentVar>
          <tableData>
            30.0   0.00
            60.0   0.50
         </tableData>
        </table>
        <gain>fcs/pitch-damper/active</gain>
        <output>fcs/pitch-damper/rate</output>
      </scheduled_gain>

      <summer name="names/elevator/cmd-sum">
          <input>fcs/elevator-cmd-norm</input>
          <input>fcs/pitch-trim-cmd-norm</input>
          <input>fcs/pitch-damper/rate</input>
          <clipto>
              <min>-1.0</min>
              <max>1.0</max>
          </clipto>
          <output>fcs/elevator/cmd-sum</output>
      </summer>

      <!-- At high speeds elevator up deflection is reduced,
           At high altitude elevator up deflection is increased -->
      <scheduled_gain name="names/elevator/adjust-neg">
        <input>fcs/elevator/cmd-sum</input>
        <table>
          <independentVar lookup="row">velocities/mach</independentVar>
          <independentVar lookup="column">atmosphere/density-altitude</independentVar>
          <tableData>
                          0.0      20000     45000
              0.0         1.00      1.00      1.00
              0.5         1.00      1.00      1.00
              0.625       0.85      1.00      1.00
              0.75        0.45      1.00      1.00
              1.0         0.18      0.60      1.00
              1.5         0.10      0.20      1.00
              2.2         0.05      0.10      0.30
          </tableData>
        </table>
        <output>fcs/elevator/cmd-adjust-negative</output>
      </scheduled_gain>

      <!-- At high speeds elevator down deflection is reduced,
           At high altitude elevator down deflection is increased -->
      <scheduled_gain name="names/elevator/adjust-pos">
        <input>fcs/elevator/cmd-sum</input>
        <table>
          <independentVar lookup="row">velocities/mach</independentVar>
          <independentVar lookup="column">atmosphere/density-altitude</independentVar>
          <tableData>
                          0.0       45000.0
              0.0         1.00         1.0
              0.5         1.00         1.0
              0.625       0.85         1.0
              0.75        0.25         1.0
              1.0         0.08         1.0
              2.2         0.03         0.2
          </tableData>
        </table>
        <output>fcs/elevator/cmd-adjust-positive</output>
      </scheduled_gain>

      <!-- select which of the above tables is active -->
      <switch name="fcs/elevator/cmd-limited">
        <default value="fcs/elevator/cmd-adjust-positive"/>
        <test logic="OR" value="fcs/elevator/cmd-adjust-negative">
          fcs/elevator/cmd-sum lt 0
          fcs/mouse-optimized == 1
        </test>
      </switch>

      <kinematic name="names/elevator/pos-norm">
        <input>fcs/elevator/tmp-norm</input>
        <traverse>
          <setting>
            <position> -1.0 </position>
            <time>      0.0 </time>
          </setting>
          <setting>
            <position>  1.0 </position>
            <time>      0.25 </time>
          </setting>
        </traverse>
        <output>fcs/elevator/pos-norm</output>
      </kinematic>

      <switch name="names/elevator/tmp-norm">
        <default value="fcs/elevator/cmd-sum"/>
        <test logic="OR" value="fcs/elevator/pos-norm">
          systems/hydraulics/flight-system/pressure ne 1
          fcs/elevator-serviceable == 0
        </test>
        <test logic="OR" value="fcs/elevator/cmd-limited">
          fcs/elevator/limiter-enable == 1
        </test>
        <output>fcs/elevator/tmp-norm</output>
      </switch>

      <aerosurface_scale name="names/elevator/pos-rad">
          <input>fcs/elevator/pos-norm</input>
          <zero_centered> true </zero_centered>
          <domain>
            <min> -1.0 </min>
            <max>  1.0 </max>
          </domain>
          <range>
              <min>-0.4363</min><!--  -25 deg -->
              <max>0.3491</max><!--    20 deg -->
          </range>
          <output>fcs/elevator-pos-rad</output>
      </aerosurface_scale>

      <summer name="names/aileron/cmd-sum">
          <input>fcs/aileron-cmd-norm</input>
          <input>fcs/roll-trim-cmd-norm</input>
          <clipto>
              <min>-1.0</min>
              <max>1.0</max>
          </clipto>
          <output>fcs/aileron/cmd-sum</output>
      </summer>

      <!-- At high speeds aileron deflection is reduced -->
      <scheduled_gain name="names/aileron/cmd-sum-limited">
        <input>fcs/aileron/cmd-sum</input>
        <table>
          <independentVar lookup="row">velocities/mach</independentVar>
          <independentVar lookup="column">atmosphere/density-altitude</independentVar>
          <tableData>
                          0.0         60000.0
              0.0         0.47           1.0
              0.5         0.40           0.75
              1.0         0.20           0.45
              2.2         0.06           0.225
          </tableData>
        </table>
        <output>fcs/aileron/cmd-sum-limited</output>
      </scheduled_gain>

      <kinematic name="names/aileron/pos-norm">
        <input>fcs/aileron/tmp-norm</input>
        <traverse>
          <setting>
            <position> -1.0 </position>
            <time>      0.0 </time>
          </setting>
          <setting>
            <position>  1.0 </position>
            <time>      0.25 </time>
          </setting>
        </traverse>
        <output>fcs/aileron/pos-norm</output>
      </kinematic>

      <switch name="names/aileron/tmp-norm">
        <default value="fcs/aileron/cmd-sum"/>
        <test logic="OR" value="fcs/aileron/pos-norm">
          systems/hydraulics/flight-system/pressure ne 1
          fcs/aileron-serviceable == 0
        </test>
        <test logic="OR" value="fcs/aileron/cmd-sum-limited">
          fcs/aileron/limiter-enable == 1
        </test>
        <output>fcs/aileron/tmp-norm</output>
      </switch>

      <aerosurface_scale name="names/aileron/pos-rad-left">
          <input>fcs/aileron/pos-norm</input>
          <domain>
            <min> -1.0 </min>
            <max>  1.0 </max>
          </domain>
          <range>
              <min>-0.2618</min><!-- -15 deg -->
              <max>0.2618</max><!--   15 deg -->
          </range>
          <output>fcs/left-aileron-pos-rad</output>
      </aerosurface_scale>

      <aerosurface_scale name="names/aileron/pos-rad-right">
          <input>-fcs/aileron/pos-norm</input>
          <domain>
            <min> -1.0 </min>
            <max>  1.0 </max>
          </domain>
          <range>
               <min>-0.2618</min><!-- -15 deg -->
              <max>0.2618</max><!--   15 deg -->
          </range>
          <output>fcs/right-aileron-pos-rad</output>
      </aerosurface_scale>

      <pure_gain name="names/aileron/pos-deg-left">
          <input>fcs/left-aileron-pos-rad</input>
          <gain>57.296</gain>
          <output>fcs/left-aileron-pos-deg</output>
      </pure_gain>

      <summer name="names/elevon/Left-Elevon-Pos-Rad">
         <input>fcs/left-aileron-pos-rad</input>
         <input>fcs/elevator-pos-rad</input>
         <output>fcs/left-elevon-pos-rad</output>
      </summer>

      <summer name="names/elevon/Right-Elevon-Pos-Rad">
         <input>fcs/right-aileron-pos-rad</input>
         <input>fcs/elevator-pos-rad</input>
         <output>fcs/right-elevon-pos-rad</output>
      </summer> 

      <pure_gain name="names/elevon/Left-Elevon-Pos-Deg">
          <input>fcs/left-elevon-pos-rad</input>
          <gain>57.296</gain>
          <output>fcs/left-aileron-pos-norm</output><!-- is really deg, but use this for MP transmit -->
      </pure_gain>

      <pure_gain name="names/elevon/Right-Elevon-Pos-Deg">
          <input>fcs/right-elevon-pos-rad</input>
          <gain>57.296</gain>
          <output>fcs/right-aileron-pos-norm</output><!-- is really deg, but use this for MP transmit -->
      </pure_gain>
    </channel>



    <channel name="Yaw">
      <!-- Rudder can move 25 degrees to each side -->

      <switch name="names/yaw-damper/active">
        <default value="0.0"/>
        <test logic="AND" value="1">
            aero/alpha-deg ge -10
            aero/alpha-deg le  10
            fcs/yaw-damper/enable ne 0.0
            fcs/yaw-damper/serviceable == 1
        </test>
        <output>fcs/yaw-damper/active</output>
      </switch>

      <scheduled_gain name="names/yaw-damper/rate">
        <input>velocities/r-aero-rad_sec</input>
        <table>
          <independentVar lookup="row">velocities/ve-kts</independentVar>
          <tableData>
            30.0   0.00
            60.0   2.00
         </tableData>
        </table>
        <gain>fcs/yaw-damper/active</gain>
        <output>fcs/yaw-damper/rate</output>
      </scheduled_gain>

      <summer name="names/rudder/cmd-sum">
        <input>fcs/rudder-cmd-norm</input>
        <input>fcs/yaw-trim-cmd-norm</input>
        <input>fcs/yaw-damper/rate</input>
        <clipto>
          <min> -1.0 </min>
          <max>  1.0 </max>
        </clipto>
        <output>fcs/rudder/cmd-sum</output>
      </summer>

      <!-- At high speeds rudder deflection is reduced -->
      <scheduled_gain name="names/rudder/cmd-sum-limited">
        <input>fcs/rudder/cmd-sum</input>
        <table>
          <independentVar lookup="row">velocities/mach</independentVar>
          <independentVar lookup="column">atmosphere/density-altitude</independentVar>
          <tableData>
                          0.0         70000.0
              0.0         0.60           1.00
              0.5         0.22           0.40
              1.0         0.11           0.25
              2.2         0.05           0.10              
          </tableData>
        </table>
        <output>fcs/rudder/cmd-sum-limited</output>
      </scheduled_gain>

      <kinematic name="names/rudder/pos-norm">
        <input>fcs/rudder/tmp-norm</input>
        <traverse>
          <setting>
            <position> -1.0 </position>
            <time>      0.0 </time>
          </setting>
          <setting>
            <position>  1.0 </position>
            <time>      0.5 </time>
          </setting>
        </traverse>
        <output>fcs/rudder-pos-norm</output>
      </kinematic>

      <switch name="names/rudder/tmp-norm">
        <default value="fcs/rudder/cmd-sum"/>
        <test logic="OR" value="fcs/rudder-pos-norm">
          systems/hydraulics/flight-system/pressure ne 1
          fcs/rudder-serviceable == 0
        </test>
        <test logic="OR" value="fcs/rudder/cmd-sum-limited">
          fcs/rudder/limiter-enable == 1
        </test>
        <output>fcs/rudder/tmp-norm</output>
      </switch>

      <aerosurface_scale name="names/rudder/pos-rad">
        <input>fcs/rudder-pos-norm</input>
        <domain>
          <min> -1.0 </min>
          <max>  1.0 </max>
        </domain>
        <range>
          <min> -0.4363 </min>
          <max>  0.4363 </max><!-- 25 deg -->
        </range>
        <output>fcs/rudder-pos-rad</output>
      </aerosurface_scale>

      <aerosurface_scale name="names/rudder/pos-deg">
        <input>fcs/rudder-pos-norm</input>
        <domain>
          <min> -1.0 </min>
          <max>  1.0 </max>
        </domain>
        <range>
          <min> -25 </min>
          <max>  25 </max>
        </range>
        <output>fcs/rudder-pos-deg</output>
      </aerosurface_scale>
    </channel>



    <channel name="Landing Gear">
      <switch name="names/gear-tmp-norm">
          <default value="gear/gear-cmd-norm"/>
          <test logic="OR" value="gear/gear-pos-norm">
              systems/hydraulics/flight-system/pressure ne 1
              gear/serviceable == 0
          </test>
          <clipto>
              <min>  0 </min>
              <max>  1 </max>
          </clipto>
          <output>gear/gear-tmp-norm</output>
      </switch>

      <kinematic name="names/gear-pos-norm">
        <input>gear/gear-tmp-norm</input>
        <traverse>
          <setting>
            <position>0.0</position>
            <time>0.0</time>
          </setting>
          <setting>
            <position>1.0</position>
            <time>5</time>
          </setting>
        </traverse>
        <output>gear/gear-pos-norm</output>
      </kinematic>

      <kinematic name="names/nose-wheel-steering/kinematic-norm">
        <input>gear/unit[0]/nose-wheel-steering/tmp-norm</input>
        <traverse>
          <setting>
            <position>-1.0</position>
            <time>0.0</time>
          </setting>
          <setting>
            <position>1.0</position>
            <time>0.5</time>
          </setting>
        </traverse>
        <output>gear/unit[0]/nose-wheel-steering/kinematic-norm</output>
      </kinematic>

      <switch name="names/nose-wheel-steering/tmp-norm">
          <default value="fcs/steer-cmd-norm"/>
          <test logic="OR" value="gear/unit[0]/nose-wheel-steering/kinematic-norm">
              systems/hydraulics/flight-system/pressure ne 1
              gear/unit[0]/nose-wheel-steering/serviceable == 0
          </test>
          <test logic="OR" value="0">
              gear/unit[0]/nose-wheel-steering/enable == 0
          </test>
          <output>gear/unit[0]/nose-wheel-steering/tmp-norm</output>
      </switch>

      <scheduled_gain name="names/nose-wheel-steering/steer-pos-deg">
        <input>gear/unit[0]/nose-wheel-steering/kinematic-norm</input>
        <table>
          <independentVar>velocities/vg-fps</independentVar>
          <tableData><!-- note that this is positive also when moving in reverse -->
              10.0        80.0
              20.0        50.0
              50.0        10.0
              150.0       2.5
              200.0       2.0 <!-- by this speed the front wheel hardly touches the runway -->
          </tableData>
        </table>
        <output>fcs/steer-pos-deg</output>
      </scheduled_gain>
    </channel>



    <channel name="Flaps">
      <!-- Can move 30 degrees down, and 4 degrees up -->

      <kinematic name="names/flaps/pos-norm">
        <input>fcs/flaps-tmp-norm</input>
        <traverse>
          <setting>
            <position>  0.0 </position>
            <time>      0.0 </time>
          </setting>
          <setting>
            <position>  1.0 </position>
            <time>      3.0 </time>
          </setting>
        </traverse>
        <output>fcs/flap-pos-normalized</output>
      </kinematic>

      <switch name="names/flaps/tmp-norm">
        <default value="gear/gear-cmd-norm"/><!-- flaps controlled by gear-->
        <test logic="OR" value="fcs/flap-pos-normalized">
          systems/hydraulics/flight-system/pressure ne 1
          fcs/flaps-serviceable == 0
        </test>
        <test logic="OR" value="0.11765"><!-- default flaps position -->
          fcs/flap-pos-cmd == 0
        </test>
        <output>fcs/flaps-tmp-norm</output>
      </switch>

      <aerosurface_scale name="names/flaps/pos-deg">
        <input>fcs/flap-pos-normalized</input>
        <zero_centered> false </zero_centered>
        <domain>
          <min>  0.0 </min>
          <max>  1.0 </max>
        </domain>
        <range>
          <min> -4.0 </min>
          <max> 30.0 </max>
        </range>
        <output>fcs/flap-pos-deg</output>
      </aerosurface_scale>

      <pure_gain name="names/flaps/pos-deg-MP">
          <input>fcs/flap-pos-deg</input>
          <gain>1</gain>
          <output>fcs/flap-pos-norm</output><!-- is really deg, used for auto MP transmit and animation -->
      </pure_gain>

    </channel>

    <!--<channel name="Throttle">
      <kinematic name="fcs/throttle-pos-norm-kinematic">
        <input>fcs/throttle-cmd-norm</input>
        <traverse>
          <setting>
            <position>  0.0 </position>
            <time>      0.0 </time>
          </setting>
          <setting>
            <position>  1.0 </position>
            <time>      4.0 </time>
          </setting>
        </traverse>
      </kinematic>

        pure_gain is the only component that can overwrite fcs/throttle-pos-norm
      <pure_gain name="names/throttle-pos-norm">
        <input>fcs/throttle-pos-norm-kinematic</input>
        <gain>1.0</gain>
        <output>fcs/throttle-pos-norm</output>
      </pure_gain>
    </channel>-->

    <channel name="Autopilot">
      <scheduled_gain name="names/autopilot/Autopilot-max-climb">
        <input>autopilot/one</input>
        <table>
          <independentVar lookup="row">velocities/mach</independentVar>
          <tableData>
              0.25            5        
              0.5          5000        
              1.0         30000       
          </tableData>
        </table>
        <output>autopilot/climb</output>
      </scheduled_gain>

      <pure_gain name="names/autopilot/Autopilot-min-climb">
          <input>autopilot/climb</input>
          <gain>-0.2</gain>
          <output>autopilot/descent</output>
      </pure_gain>
    </channel>



    <channel name="Hook">
        <kinematic name="names/carrier/hook-pos-norm">
            <input>fcs/hook-engage</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>0</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>2.5</time>
                </setting>
            </traverse>
            <output>fcs/hook-pos-norm</output>
        </kinematic>
    </channel>

    <!--<channel name="View">
      <summer name="position/h-sl-pilot-ft">
        <input>position/h-sl-ft</input>
        <input>position/selection-view-offset</input>
      </summer>
    </channel>-->



    <channel name="Wings">
      <aerosurface_scale name="names/structural/Wings-normal-factor">
        <input>structural/wings/serviceable</input>
        <zero_centered> false </zero_centered>
        <domain>
          <min>  0.0 </min>
          <max>  1.0 </max>
        </domain>
        <range>
          <min> 0.2 </min>
          <max> 1.0 </max>
        </range>
        <output>structural/wings/normal-factor</output>
      </aerosurface_scale>
    </channel>
  </flight_control>